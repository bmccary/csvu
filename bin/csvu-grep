#!/usr/bin/env python

if __name__ == '__main__':

    from CSVU import CSVUDictReader, CSVUDictWriter, GrepFilter

    import sys
    import argparse

    parser = argparse.ArgumentParser(description='CSVU Grep')

    parser.add_argument('-v', default=True, action='store_const', const=False)
    parser.add_argument('--column', required=True, type=str)
    parser.add_argument('regex', type=str)

    args = parser.parse_args()

    reader = BCSVDictReader(f=sys.stdin)
    grep   = GrepFilter(col=args.column, include=args.v, regex=args.regex)
    writer = BCSVDictWriter(f=sys.stdout, fieldnames=reader.fieldnames)

    writer.writeheader()
    writer.writerows(row for row in reader if grep(row))

# vim:ts=4:sw=4:et

